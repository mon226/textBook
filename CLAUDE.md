# 実装ガイドライン

## カラーパレット使用規則

### 基本ルール
- **必ず定義済みのCSS変数を使用する** - 直接色コードを書かない
- 色は `/app/globals.css` に定義されているカラーパレットから選択する
- 新しい色が必要な場合は、まず既存のパレットから適切なものがないか確認する

### 色の使い分け
- **背景色**: `var(--white)`, `var(--gray)`, グラデーション用クラス
- **テキスト**: `var(--text-1)` (濃い), `var(--text-2)` (明るい), `var(--text-3)` (アクセント)
- **ボタン**: `.btn-primary`, `.btn-secondary` クラスを使用
- **科目別**: `.subject-[科目名]` クラスを使用

### 使用例
```css
/* 良い例 */
background-color: var(--main-1);
color: var(--text-1);

/* 悪い例 */
background-color: #635d73;
color: #373231;
```

## コンポーネント作成時の注意

### スタイリング
1. Tailwind CSSのクラスを優先的に使用
2. カスタムスタイルが必要な場合は、globals.cssに定義したユーティリティクラスを使用
3. インラインスタイルは避ける

### 命名規則
- コンポーネント: PascalCase (例: `MyComponent`)
- ファイル名: kebab-case (例: `my-component.tsx`)
- CSS クラス: kebab-case (例: `btn-primary`)
- CSS 変数: kebab-case (例: `--main-color`)

## ファイル構成
```
/app
  /components    # 共通コンポーネント
  /[page-name]   # ページ固有のファイル
  globals.css    # グローバルスタイル（カラーパレット定義）
  layout.tsx     # レイアウト
  page.tsx       # ホームページ
```

## 開発コマンド
- 開発サーバー起動: `npm run dev`
- ビルド: `npm run build`
- 型チェック: `npm run typecheck` (もし設定されていれば)
- リント: `npm run lint` (もし設定されていれば)

## Vercel デプロイ
- mainブランチにpushすると自動デプロイ
- プレビューデプロイはPRを作成すると生成される

## レスポンシブデザイン

### ブレークポイント
- **スマホ**: 375px〜428px
- **中間サイズ**: 428px〜780px（スマホとタブレットの中間的なデザイン）
- **タブレット**: 780px〜960px
- **PC**: 960px以上（タブレットデザインを中央配置、最大幅960px）

### サイズ指定のルール
- **px使用禁止**: 基本的にvw、vh、rem、%を使用
- **フォントサイズ**: clamp()関数またはvw単位を使用
- **スペーシング**: vw単位またはrem単位を使用
- **最大幅制限**: PC環境では`max-width: 960px`で中央配置

### 実装例
```css
/* 良い例 */
font-size: clamp(1rem, 4vw, 1.5rem);
padding: 3vw;
margin: 0 auto;
max-width: 960px;

/* 悪い例 */
font-size: 16px;
padding: 20px;
width: 768px;
```

### メディアクエリの優先順位
1. モバイルファーストで実装
2. 必要に応じて`min-width`でブレークポイントを追加
3. Tailwind CSSのレスポンシブプレフィックスを活用（sm:, md:, lg:）

## ホームページのスクロールアニメーション仕様

### 基本仕様
- 各科目カードは画面高さいっぱい（100vh）で表示
- position: stickyを使用した重なるアニメーション
- 前のカードは完全に固定され、次のカードが下から覆い被さるように出現

### カードの背景色
- 各科目のサブカラーを使用
  - 英語: `var(--english-sub)`
  - 数学: `var(--math-sub)`
  - 国語: `var(--japanese-sub)`
  - 理科: `var(--physics-sub)`
  - 社会: `var(--history-jp-sub)`

### アニメーション動作
- スマホ版：下から上へのスライド（fade-in-up）
- タブレット版：横からのスライドも混在（fade-in-left/right）
- スクロール時：前のカードは動かず、次のカードのみ移動

### 未解決の課題
- スクロールアニメーションが理想通りに動作しない（一旦放置）
- 参考サイト（https://www.greenbokujo.jp/）のような重なりアニメーションの実装が必要

### スクロールアニメーション実装手順（再実装時の参考）

#### 要件
1. 各カードは100vh
2. カードが表示されてから10vh分は固定（スクロールしても動かない）
3. その後20vh分のスクロールで次のカードが下から覆い被さる
4. 前のカードは絶対に動かない（position: fixedのような挙動）

#### 実装アプローチ
1. 各カードをposition: fixedで配置
2. 初期状態で2枚目以降のカードはtransform: translateY(100%)で画面外に
3. スクロール位置を監視し、適切なタイミングでtransformを変更
4. z-indexで重なり順を管理（後のカードほど上）

#### スクロール計算
- カード1: 0〜110vh（最後の10vhは固定表示）
- カード2: 110vh〜220vh（90vh〜110vhで出現アニメーション）
- カード3: 220vh〜330vh（200vh〜220vhで出現アニメーション）
- 以降同様

#### 注意点
- position: stickyではなくposition: fixedを使用
- transformのみでアニメーション（topやbottomは使わない）
- パフォーマンスのためrequestAnimationFrameを使用

## PDFファイル管理
- PDFファイルは `/public/pdf` フォルダに配置
- 現在のPDF: `二子玉川参考書紹介'25.pdf`

## PDF閲覧ページ
- レスポンシブデザイン（スマホ100%、PC最大960px）
- 背景: 全体はbg-gradient-main、コンテンツ部分は#fbdfe1→#cc8699のグラデーション
- 高さ: 100vh固定
- PC版: 左右に#b28247の境界線（3px）

### PDFビューアー機能
- 画像ファイル使用: `/public/img/pam/二子玉川参考書紹介'25[番号].webp`（52ページ）
- ページ番号仕様:
  - 0ページから開始（表紙）
  - 最大51ページ
  - 表示は基本的に奇数ページ（1,3,5...）、ただし0と51は例外
  - 偶数入力時は自動で-1して奇数ページに変換
- 見開き表示: 
  - 0ページ（表紙）と51ページ（裏表紙）は単体表示
  - その他は見開き表示（1-2, 3-4, 5-6...）
- ページめくり: 左右クリックエリア、ボタン、キーボード（←→）、スワイプ
- 画像表示: 最大幅90%、中央配置、縦横比保持
- 画像保護機能:
  - 右クリック無効化
  - ドラッグ無効化
  - 本番環境のみ開発者ツール無効化

### スライドインフッター
- トップページと同じ仕様を採用
- ヘッダー完全廃止
- ページ番号入力: フッター内でクリックして切り替え表示
- デザイン: `translate-y-[calc(100%-3rem)]`でほぼ隠れ、ホバーで全表示

### 今後の実装予定
- 拡大縮小機能（PC: マウスホイール/キーボード、スマホ: ピンチズーム）

## 講師データ管理
- 講師プロフィールは `/app/data/instructors.ts` に定義
- 講師数: 13名（A〜M講師）
- 各講師には以下の情報を含む：
  - 出身校（中高）
  - 大学・学部
  - 担当科目
  - テーマカラー
  - 性別

## 各科目ページの構成

### 科目別子要素
- **英語**: 英単語、英文法、長文読解、リスニング、速読
- **数学**: 勉強の進め方〜数学編〜、数学参考書一覧、講師陣の使用していた参考書、共通テストと数学
- **国語**: 現代文なんでも相談室
- **理科**: 勉強の進め方〜理科編〜、理科の参考書
- **社会**: 日本史、世界史、地理

### 科目カードのレイアウト
- 科目名・説明・view moreボタンを上部に配置（pt-[5vw]）
- 空いたスペースに小項目ボタンを縦に配置
- 小項目ボタンのスタイル:
  - 幅: 100%
  - 枠線: 2px solid メインカラー
  - 背景色: mixWithWhite(colorCode, 0.85)（白多めの混合色）
  - 文字色: メインカラー
  - 間隔: 2vw
  - パディング: py-[2.5vw] px-[4vw]

## ボタンデザイン

### view more! ボタンのホバーエフェクト
- 回転する点線ボーダーを実装
- `.view-more-btn` クラスを適用
- ホバー時に点線が移動するアニメーション（ベルトコンベアのような動き）
- ボタンスタイル:
  - 背景色: `mixWithWhite(colorCode, 0.85)` (白85%とメインカラー15%の混合 = ほぼ白っぽい)
  - 枠線: `2px solid mixWithWhite(colorCode, 0.3)` (白30%とメインカラー70%の混合 = 少し薄め)
  - 文字色: メインカラーそのまま
  - フォントサイズ: `clamp(0.875rem, 2vw, 1.125rem)` (PC版で最大1.125remに拡大)
  - ホバー時: 背景色と文字色が反転（背景がメインカラー、文字が白っぽい色）
  - mixWithWhite関数: HEXカラーをRGBに変換し、白と指定比率で混合後、HEXに戻す
- 実装詳細:
  - SVGを使用して4要素構成（左半円、右半円、上線、下線）
  - viewBox="0 0 100 100"で数値座標を使用
  - 数学的定義に基づく実装:
    - ボタン: 幅w、高さh、radius=h/2
    - ボタン中心を(0,0)として計算
    - 点線との距離: d = h * 0.10
    - 上下線のy座標: ±(d + h/2)
    - 直線の長さ: w - h
    - 左半円の中心: (-(w-h)/2, 0)、右半円の中心: ((w-h)/2, 0)
    - 半円の半径: h/2 + d
    - SVGサイズ: 幅 w + 2(r+d)、高さ h + 2d
    - viewBox(0-100)への変換計算を実施
  - strokeDasharray: "10 2"（実線部分が長く、透明部分が短い）
  - 半円のstrokeWidth: 1.0（細め）、上下の線のstrokeWidth: 2.4（太め）
  - vectorEffect="non-scaling-stroke"で線幅を保持
  - generateSVGPaths関数でボタンサイズに応じたパスを生成
  - useRefでボタンサイズを測定し、レスポンシブ対応
  - 各科目のcolorCodeを使用してボタンと同じ色の点線
  - ホバー時にstroke-dashoffset: -4vwで点線を大きく移動
  - 0.4秒のtransitionでスムーズなアニメーション

## PDFビューアーのレスポンシブ対応

### タブレット高さ問題の修正
- タブレット（mdブレークポイント以上）では`100dvh`を使用
- 動的ビューポート単位でブラウザUIを考慮した高さ設定
- フレックスボックスレイアウトでPDF表示エリアとフッターを適切に配分
- `overflow-hidden`でスクロールを防止

### 実装詳細
```css
/* 最外側のコンテナ */
min-h-screen md:h-[100dvh] md:overflow-hidden

/* メインコンテンツ */
h-screen md:h-[100dvh]

/* PDF表示領域とフッターの親要素 */
flex flex-col

/* PDF表示エリア */
flex-1 /* フッターの高さを除いた残り全体を使用 */

/* フッター */
position: static /* absoluteからstaticに変更してflexレイアウトに組み込む */
```

### ナビゲーションUI仕様
- **PC版**: inputタグでページ番号を直接入力可能
- **スマホ/タブレット版**: ページ番号は表示のみ（inputタグ非表示）
- **ナビゲーションボタン**:
  - ◁◁: 10ページ戻る（見開き調整あり）
  - ◁: 前のページへ（通常は2ページ戻る）
  - ▷: 次のページへ（通常は2ページ進む）
  - ▷▷: 10ページ進む（見開き調整あり）
- **見開きページの調整**: 
  - 0（表紙）と51（裏表紙）以外は奇数ページに調整
  - 10ページジャンプ時も自動的に奇数ページに修正

## 作業フロー（必須手順）

### 新しいタスクを受けたとき
1. **TodoListを作成**（3つのタスク）
   - メインタスク
   - 実装ガイドライン確認・更新
   - git commit & push

### タスク完了時のチェックリスト
- [ ] メインタスクが完了している
- [ ] 実装ガイドライン（CLAUDE.md）を確認・更新した
- [ ] git status → add → commit → push を実行した

### 忘れやすいポイント
- 実装後は必ず実装ガイドラインを更新
- 変更は必ずgitにcommit & push
- TodoListを使って進捗管理

## その他の注意事項
- 画像は `/public` フォルダに配置
- 環境変数は `.env.local` に記載（Vercelの環境変数設定も忘れずに）
- TypeScriptの型定義を積極的に使用する