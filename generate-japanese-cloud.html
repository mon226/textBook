<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>和風雲ランダム生成</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    label {
      display: inline-block;
      width: 150px;
      font-weight: bold;
    }
    
    input[type="range"] {
      width: 200px;
    }
    
    .value {
      display: inline-block;
      width: 50px;
      text-align: right;
    }
    
    button {
      background: #0080b8;
      color: white;
      border: none;
      padding: 10px 30px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    
    button:hover {
      background: #006090;
    }
    
    .preview {
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    #cloudSvg {
      width: 100%;
      height: auto;
      border: 1px solid #eee;
    }
    
    .code-output {
      background: #f8f8f8;
      padding: 20px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .info {
      background: #e8f4f8;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>和風雲ランダム生成ツール</h1>
    
    <div class="info">
      <strong>和風雲の特徴：</strong>
      <ul>
        <li>山層：左半円 → 上直線 → 右半円 → 下直線</li>
        <li>谷層：右半円 → 左半円（この順番が重要）</li>
        <li>山と谷が交互に配置（最上層と最下層は必ず山）</li>
        <li>一筆書きで描かれる連続パス</li>
      </ul>
    </div>
    
    <div class="controls">
      <div class="control-group">
        <label>層の数（奇数のみ）:</label>
        <input type="range" id="layers" min="3" max="9" step="2" value="5">
        <span class="value" id="layersValue">5</span>
      </div>
      
      <div class="control-group">
        <label>山の最小幅:</label>
        <input type="range" id="minWidth" min="20" max="60" value="30">
        <span class="value" id="minWidthValue">30</span>
      </div>
      
      <div class="control-group">
        <label>山の最大幅:</label>
        <input type="range" id="maxWidth" min="60" max="150" value="100">
        <span class="value" id="maxWidthValue">100</span>
      </div>
      
      <div class="control-group">
        <label>層の高さ（半径）:</label>
        <input type="range" id="radius" min="10" max="30" value="15">
        <span class="value" id="radiusValue">15</span>
      </div>
      
      <div class="control-group">
        <label>各層の山の数:</label>
        <input type="range" id="mountainsPerLayer" min="3" max="10" value="5">
        <span class="value" id="mountainsPerLayerValue">5</span>
      </div>
      
      <button onclick="generateCloud()">新しい雲を生成</button>
      <button onclick="downloadSVG()">SVGをダウンロード</button>
    </div>
    
    <div class="preview">
      <svg id="cloudSvg" viewBox="0 0 800 200">
        <!-- 生成された雲がここに表示されます -->
      </svg>
    </div>
    
    <div class="code-output">
      <h3>生成されたSVGコード:</h3>
      <code id="svgCode"></code>
    </div>
  </div>

  <script>
    // スライダーの値を表示
    document.querySelectorAll('input[type="range"]').forEach(input => {
      input.addEventListener('input', (e) => {
        document.getElementById(e.target.id + 'Value').textContent = e.target.value;
      });
    });

    function generateCloud() {
      const layers = parseInt(document.getElementById('layers').value);
      const minWidth = parseInt(document.getElementById('minWidth').value);
      const maxWidth = parseInt(document.getElementById('maxWidth').value);
      const radius = parseInt(document.getElementById('radius').value);
      const mountainsPerLayer = parseInt(document.getElementById('mountainsPerLayer').value);
      
      // 各山層の山の幅をランダムに生成
      const mountainWidths = [];
      for (let j = 0; j < mountainsPerLayer; j++) {
        const width = minWidth + Math.random() * (maxWidth - minWidth);
        mountainWidths.push(width);
      }
      
      // SVGのサイズを計算
      const totalWidth = mountainWidths.reduce((a, b) => a + b, 0) + radius * 4 + (mountainsPerLayer - 1) * radius * 2;
      const totalHeight = layers * radius * 2 + radius * 2;
      
      // パスを生成（一筆書き）
      let path = '';
      let currentX = radius * 2;
      
      // 層のY座標を計算する関数
      const getLayerY = (layerIndex) => radius * 2 + layerIndex * radius * 2;
      
      // 最上段の山層の左半円から開始
      path = `M ${currentX} ${getLayerY(0)} `;
      
      // 下方向への描画（山左半円→直線→谷右半円→直線→...）
      for (let col = 0; col < mountainsPerLayer; col++) {
        const width = mountainWidths[col];
        
        // 各列を下方向に描画
        for (let layerIndex = 0; layerIndex < layers; layerIndex++) {
          const isValley = layerIndex % 2 === 1;
          const y = getLayerY(layerIndex);
          
          if (isValley) {
            // 谷層
            if (col % 2 === 0) {
              // 偶数列：谷右半円
              path += `A ${radius} ${radius} 0 0 1 ${currentX} ${y + radius * 2} `;
            } else {
              // 奇数列：谷左半円
              path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y + radius * 2} `;
            }
            
            // 谷から次の山への直線
            if (col % 2 === 0) {
              // 右から左へ
              currentX -= width;
              path += `L ${currentX} ${y + radius * 2} `;
            } else {
              // 左から右へ
              currentX += width;
              path += `L ${currentX} ${y + radius * 2} `;
            }
          } else {
            // 山層
            if (layerIndex > 0) {
              // 最初の山層以外は谷からの接続
              if (col % 2 === 0) {
                // 山左半円
                path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y - radius} `;
              } else {
                // 山右半円
                path += `A ${radius} ${radius} 0 0 1 ${currentX} ${y - radius} `;
              }
            } else if (col > 0) {
              // 最上段の2つ目以降の山
              if (col % 2 === 0) {
                path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y - radius} `;
              } else {
                path += `A ${radius} ${radius} 0 0 1 ${currentX} ${y - radius} `;
              }
            } else {
              // 最初の山左半円（開始点）
              path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y - radius} `;
            }
            
            // 山の上直線
            if (col % 2 === 0) {
              // 左から右へ
              currentX += width;
              path += `L ${currentX} ${y - radius} `;
            } else {
              // 右から左へ
              currentX -= width;
              path += `L ${currentX} ${y - radius} `;
            }
            
            // 次の谷への接続（最下段以外）
            if (layerIndex < layers - 1) {
              // 谷への接続なので半円は描かない、位置だけ移動
              path += `L ${currentX} ${y} `;
            }
          }
        }
        
        // 最下段での処理
        if (col < mountainsPerLayer - 1) {
          const bottomY = getLayerY(layers - 1);
          
          // 最下段の山の残り部分を完成
          if (col % 2 === 0) {
            // 山右半円
            path += `A ${radius} ${radius} 0 0 0 ${currentX} ${bottomY} `;
            // 下長い直線（左から右）
            currentX += radius * 2;
            path += `L ${currentX} ${bottomY} `;
          } else {
            // 山左半円
            path += `A ${radius} ${radius} 0 0 1 ${currentX} ${bottomY} `;
            // 下長い直線（右から左）
            currentX -= radius * 2;
            path += `L ${currentX} ${bottomY} `;
          }
        }
      }
      
      // 最後の列の上方向への描画
      const lastCol = mountainsPerLayer - 1;
      for (let layerIndex = layers - 1; layerIndex >= 0; layerIndex--) {
        const isValley = layerIndex % 2 === 1;
        const y = getLayerY(layerIndex);
        const width = mountainWidths[lastCol];
        
        if (layerIndex === layers - 1) {
          // 最下段の山の完成
          if (lastCol % 2 === 0) {
            path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y} `;
          } else {
            path += `A ${radius} ${radius} 0 0 1 ${currentX} ${y} `;
          }
        } else if (isValley) {
          // 谷層（上向き）
          if (lastCol % 2 === 0) {
            // 谷左半円
            path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y} `;
            // 左から右へ
            currentX += width;
            path += `L ${currentX} ${y} `;
          } else {
            // 谷右半円
            path += `A ${radius} ${radius} 0 0 1 ${currentX} ${y} `;
            // 右から左へ
            currentX -= width;
            path += `L ${currentX} ${y} `;
          }
        } else {
          // 山層（上向き）
          if (lastCol % 2 === 0) {
            // 山右半円
            path += `A ${radius} ${radius} 0 0 1 ${currentX} ${y + radius} `;
          } else {
            // 山左半円
            path += `A ${radius} ${radius} 0 0 0 ${currentX} ${y + radius} `;
          }
          
          if (layerIndex === 0) {
            // 最上段：上長い直線
            if (lastCol % 2 === 0) {
              // 右から左へ
              currentX -= width + radius * 2;
              path += `L ${currentX} ${y + radius} `;
            } else {
              // 左から右へ（このケースは通常ない）
              currentX += width + radius * 2;
              path += `L ${currentX} ${y + radius} `;
            }
          } else {
            // 中間の山層
            if (lastCol % 2 === 0) {
              currentX -= width;
              path += `L ${currentX} ${y + radius} `;
            } else {
              currentX += width;
              path += `L ${currentX} ${y + radius} `;
            }
            path += `L ${currentX} ${y} `;
          }
        }
      }
      
      // SVGを更新
      const svg = document.getElementById('cloudSvg');
      svg.setAttribute('viewBox', `0 0 ${totalWidth} ${totalHeight}`);
      svg.innerHTML = `
        <path d="${path}" 
              fill="none" 
              stroke="#231815" 
              stroke-width="2" 
              stroke-miterlimit="10" />
      `;
      
      // コードを表示
      document.getElementById('svgCode').textContent = svg.outerHTML;
    }
    
    function downloadSVG() {
      const svg = document.getElementById('cloudSvg');
      const svgData = svg.outerHTML;
      const blob = new Blob([svgData], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'japanese-cloud.svg';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // 初期生成
    generateCloud();
  </script>
</body>
</html>